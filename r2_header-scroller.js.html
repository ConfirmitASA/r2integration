<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>r2/header-makeHeaderScrollable.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Detabinator.html">Detabinator</a></li><li><a href="HeaderScroller.html">HeaderScroller</a><ul class='methods'><li data-type='method'><a href="HeaderScroller.html#resizeFixed">resizeFixed</a></li><li data-type='method'><a href="HeaderScroller.html#scrollFixed">_scrollFixed</a></li></ul></li><li><a href="MDHierarchy.html">MDHierarchy</a></li><li><a href="MenuTransformer.html">MenuTransformer</a><ul class='methods'><li data-type='method'><a href="MenuTransformer.html#scroller">makeHeaderScrollable</a></li><li data-type='method'><a href="MenuTransformer.html#swapHeader">swapHeader</a></li></ul></li><li><a href="SideNav.html">SideNav</a></li></ul>
</nav>

<div id="main">

    <h1 class="page-title">r2/header-makeHeaderScrollable.js</h1>







    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
class HeaderScroller{
  /**
   * `HeaderScroller` is a class that listens to `iframeEl`'s contentWindow.enablePageScroll event and scrolls the `header` when the iframeEl is scrolled
   * @param {Window} win - iframeEl.contentWindow
   * @param {HTMLElement} header - header element that needs to be scrolled
   * */
  constructor(win,header){
    win.requestAnimationFrame = win.requestAnimationFrame || win.mozRequestAnimationFrame || win.webkitRequestAnimationFrame || win.msRequestAnimationFrame;

    this._meta = {
      ticking:false,
      offsetHeight:null,
      header:null,
      lastScrollY:0,
      contentWindow:win
    };
    this.header = header;
  }

  get header(){
    return this._meta.header;
  }
  set header(val){
    let offset;
    if(this.header!=null){
      offset = `${this._meta.header.style.top}px`;
      this._meta.header.style.top = "0px";
      this._meta.header.classList.remove('scrollable-header');
      this.detachListeners();
    }
    this._meta.header = val;
    this._meta.header.style.top = offset;
    this._meta.header.classList.add('scrollable-header');
    this._meta.offsetHeight = this._meta.header.offsetHeight; //calculate header height
    this._meta.contentWindow.document.querySelector('body').style.marginTop = this._meta.header.offsetHeight + "px";
    this.attachListeners();
  }

  requestTick(callback){
    if(!this._meta.ticking) {
      requestAnimationFrame(callback);
      this._meta.ticking = true;
    }
  }

  attachListeners(){
    let win = this._meta.contentWindow;
    win.addEventListener("enablePageScroll", this._scrollFixed.bind(this), false); // attach a resize listener to resize the header
    //win.addEventListener("enablePageScroll", this.resizeFixed.bind(this), false); // attach a resize listener to resize the header
  }
  detachListeners(){
    let win = this._meta.contentWindow;
    win.removeEventListener("enablePageScroll", this._scrollFixed); // attach a resize listener to resize the header
    //win.removeEventListener("enablePageScroll", this.resizeFixed); // attach a resize listener to resize the header
  }


  /**
   * Calculates widths for all columns in the fixed header based on the `source`
   * */
  resizeFixed(){
    this.requestTick(()=>{
      this._meta.offsetHeight = this.header.offsetHeight;
      this._meta.ticking=false;
      this._scrollFixed(); // to compensate top offset in case after resize the table is less in height and top has changed
    })
  }

  /**
   * Displays a fixed header when the table header is scrolled off the screen
   * */
  _scrollFixed() {
    //console.log(this._meta.contentWindow);
    this._meta.lastScrollY = this._meta.contentWindow.pageYOffset;
    this.requestTick(this.constructor._scrollCallback.bind(this));
  }

  static _scrollCallback(){
    let offset = this._meta.lastScrollY,
      offsetTop = this._meta.offsetHeight;
    this.header.style.top=-offset+'px';
    this._meta.ticking=false;
  }
}

export default HeaderScroller
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Jan 11 2017 09:00:08 GMT+0300 (Russia TZ 2 Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>

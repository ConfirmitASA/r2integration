<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>navigation/menu-transformer.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Detabinator.html">Detabinator</a></li><li><a href="HeaderScroller.html">HeaderScroller</a><ul class='methods'><li data-type='method'><a href="HeaderScroller.html#resizeFixed">resizeFixed</a></li><li data-type='method'><a href="HeaderScroller.html#scrollFixed">_scrollFixed</a></li></ul></li><li><a href="MDHierarchy.html">MDHierarchy</a></li><li><a href="MenuTransformer.html">MenuTransformer</a><ul class='methods'><li data-type='method'><a href="MenuTransformer.html#scroller">makeHeaderScrollable</a></li><li data-type='method'><a href="MenuTransformer.html#swapHeader">swapHeader</a></li></ul></li><li><a href="SideNav.html">SideNav</a></li></ul>
</nav>

<div id="main">

    <h1 class="page-title">navigation/menu-transformer.js</h1>







    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import SideNav from "../side-nav/side-nav";
import MediaQuery from "media-query";
import HeaderScroller from "../r2/header-makeHeaderScrollable";


class MenuTransformer{
  /**
   * This class sets up a listener to detect whether the viewport matches the max-width set up in `breakpoint` and based on existence of an integration-iframe
   * sets up heade scrollers or just swaps the header into horizontal or sidebar navigation modes
   * @param {Number} [breakpoint=768] - max-width of device viewport that is considered to be a mobile device and hosts a mobile sidebar.
   * @requires MediaQuery
   * @requires SideNav
   * @requires HeaderScroller
   * */
  constructor(breakpoint=768){
    this.iframe = document.querySelector('.r2dashboard');

    this.header = document.querySelector('.reportal-bar');

    // if it's integration page - do scrolling
    if(this.iframe){
      document.querySelector('.body-wrapper').classList.add('integration-mode'); //reverse layout to make header appear above iframe

      this.pScroller = new Promise((resolve,reject)=>{
        let makeHeaderScrollable;
        if(this.iframe.contentWindow.location.href!='about:blank'){
          makeHeaderScrollable = this.makeHeaderScrollable(this.iframe.contentWindow);


          resolve(makeHeaderScrollable); //resolve to the instance of `HeaderScroller`
        } else {
          this.iframe.addEventListener('load',e=>{
            makeHeaderScrollable = this.makeHeaderScrollable(e.target.contentWindow); //initialise makeHeaderScrollable
            resolve(makeHeaderScrollable); //resolve to the instance of `HeaderScroller`
          });
        }
      });
    }
    this.sidenav = new SideNav();

    this.mediaQuery = new MediaQuery({query:`max-width:${breakpoint}px`},(matches)=>{
      console.log(matches);
      if(!matches){ // if desktop
        this.swapHeader(document.querySelector('.reportal-bar'));
        this.sidenav.removeEventListeners();
      } else { // if mobile
        this.swapHeader(document.querySelector('.reportal-header'));
        this.sidenav.addEventListeners();
      }
    },this);
  }

  /**
   * Function that sets this.header to a new HTMLElement and does the same for HeaderScroller
   * */
  swapHeader(header){
    this.header = header;
    if(this.iframe &amp;&amp; this.pScroller){
      this.pScroller.then(hs=>hs.header = header);
    }
  }


  /**
   * Function that initialises makeHeaderScrollable on the header element
   * @param {Window} w - contentWindow object of the iframe
   * @returns {HeaderScroller} Returns `HeaderScroller` instance
   * */
  makeHeaderScrollable(w){
    console.log('r2 iframe loaded');

    // quick hack to hide a black editor bar

    let rHeader = this.header,
      makeHeaderScrollable;
    if(rHeader){
      makeHeaderScrollable = new HeaderScroller(w,rHeader);
      console.log(makeHeaderScrollable);
    }
    return makeHeaderScrollable;
  }
}

export default MenuTransformer;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Jan 11 2017 09:00:08 GMT+0300 (Russia TZ 2 Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>

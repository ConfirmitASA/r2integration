<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>navigation/menu-transformer.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Detabinator.html">Detabinator</a></li><li><a href="HeaderScroller.html">HeaderScroller</a></li><li><a href="SideNav.html">SideNav</a></li><li><a href="TransformMenuAt.html">TransformMenuAt</a><ul class='methods'><li data-type='method'><a href="TransformMenuAt.html#swapHeader">swapHeader</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#upgrade">upgrade</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">navigation/menu-transformer.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import SideNav from "../side-nav/side-nav";
import MediaQuery from "media-query";
import HeaderScroller from "../r2/header-scroller";


class TransformMenuAt {
  /**
   * This class sets up a listener to detect whether the viewport matches the max-width set up in `breakpoint` and based on existence of an integration-iframeEl
   * sets up heade scrollers or just swaps the header into horizontal or sidebar navigation modes
   * @param {Number} [breakpoint=768] - max-width of device viewport that is considered to be a mobile device and hosts a mobile sidebar.
   * @param {Object} [options]
   * @param {String} [options.iframeClassName] - r2integration iframe CSS class
   * @param {String} [options.desktopHeaderClassName] - CSS class of header to display above `breakpoint`
   * @param {String} [options.mobileHeaderClassName] - CSS class of header to display below `breakpoint`
   * @requires MediaQuery
   * @requires SideNav
   * @requires HeaderScroller
   * */
  constructor(breakpoint = 768, options={}) {
    const {
            iframeClassName        = '.r2dashboard',
            desktopHeaderClassName = '.reportal-bar',
            mobileHeaderClassName  = '.reportal-header',
          } = options;

    this.iframeEl        = document.querySelector(iframeClassName);
    this.desktopHeaderEl = document.querySelector(desktopHeaderClassName);
    this.mobileHeaderEl  = document.querySelector(mobileHeaderClassName);
    this.currentHeader = null;

    if (this.isIntegrationMode){// if it's integration page - do scrolling
      this.swapHeaderAndIframe();
      this.headerScrollerInst = this.makeHeaderRespondToIframeScroll();
    }
    this.handleBreakpointMatch = this.handleBreakpointMatch.bind(this);
    this.sidenav = new SideNav();
    this.mediaQuery = new MediaQuery({query: `max-width:${breakpoint}px`}, this.handleBreakpointMatch, this);
  }

  get isIntegrationMode(){
    return !!this.iframeEl
  }

  swapHeaderAndIframe(){
    document.querySelector('.body-wrapper').classList.add('integration-mode');
  }

  handleBreakpointMatch(belowBreakpoint) {
    if (!belowBreakpoint) {
      this.swapHeader(this.desktopHeaderEl);
      this.sidenav.removeEventListeners();
    } else {
      this.swapHeader(this.mobileHeaderEl);
      this.sidenav.addEventListeners();
    }
  }

  makeHeaderRespondToIframeScroll() {
    return new Promise(resolve => {
      if (!this.isIframeURLEmpty) {
        resolve(this.makeHeaderScrollable(this.iframeEl.contentWindow));
      } else {
        this.iframeEl.addEventListener('load', e =>{
          return resolve(this.makeHeaderScrollable(e.target.contentWindow))

        }
        );
      }
    });
  }

  makeHeaderScrollable(iframeContentWindow) {
    return this.currentHeader &amp;&amp; new HeaderScroller(iframeContentWindow, this.currentHeader);
  }

  get isIframeURLEmpty() {
    return this.iframeEl.contentWindow.location.href === 'about:blank'
  }

  /**
   * Function that sets this.desktopHeaderEl to a new HTMLElement and does the same for HeaderScroller
   * */
  swapHeader(newHeader) {
    this.currentHeader = newHeader;
    if (this.iframeEl &amp;&amp; this.headerScrollerInst) {
      this.headerScrollerInst.then(headerScroller => headerScroller.header = newHeader);
    }
  }
}

export default TransformMenuAt;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Fri Mar 24 2017 13:25:38 GMT+0300 (Russia TZ 2 Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
